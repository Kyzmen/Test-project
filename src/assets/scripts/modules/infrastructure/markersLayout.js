export default async function markerslayout($container) {
    const container = typeof $container === 'string' ? document.querySelector($container) : $container;
    const sendData = new FormData();
    sendData.append('action', 'infrastructure');
    const url = window.location.href.match(/localhost/) 
        ? 'https://central-park-wp.smarto.com.ua/wp-admin/admin-ajax.php' 
        : '/wp-admin/admin-ajax.php'
    let markersData = await fetch(url, { 
        method: 'POST',
        body: sendData,
    });
    markersData = await markersData.json();
    if (!markersData) {
        console.warn('Wrong data recieved');
        return;
    };
    container.querySelectorAll('.map-nav-item-group').forEach(el => el.remove());
    markersData.forEach(category => {
        container.insertAdjacentHTML('beforeend', getCategoryLayout(category));
    });

    document.querySelectorAll('[data-nav-item-group]').forEach(el => {
        if (el.querySelector('.map-nav-subitems') === null) return;
        const openElement  = el.querySelector('.map-nav-item');
        openElement.addEventListener('click', () => {
            el.classList.toggle('active');
        })
    })
    console.log(markersData);
}
function getCategoryLayout({name, list, code, ...data}) {
    return `
    <div class="map-nav-item-group" data-nav-item-group="">
        <div class="map-nav-item"> 
            <div class="map-nav-item__marker">
                ${getCategoryIcon(code)}
            </div>
            <div class="map-nav-item__text">${name}</div>
            <div class="map-nav-item__plus">
                <svg width="29" height="29" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.1406 28.2843V0M-0.00151072 14.1421H28.2828H-0.00151072Z" stroke="#E5CDB7" stroke-width="1.5"></path></svg>
            </div>
        </div>
        <div class="map-nav-subitems">
            ${getInnerCategoryMarkersLayour(list)}
        </div>
    </div>`;
};

function getInnerCategoryMarkersLayour(list) {
    if (!list) return '';

    const layout = list.map(marker => `
        <div class="map-nav-item" data-marker-id="${marker.id}">
            <div class="map-nav-item__text">${marker.name}</div>
        </div>
    `);
    return layout.join('');
}

function getCategoryIcon(code) {
    const categoriesIcons = {
        main: '<svg width="28" height="52" viewBox="0 0 28 52" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.35818 4.92285H0V46.852H5.35818V4.92285Z" fill="#E5CDB7"/><path d="M12.876 0H7.51782V51.011H12.876V0Z" fill="#E5CDB7"/><path d="M20.481 0H15.1228V51.011H20.481V0Z" fill="#E5CDB7"/><path d="M28.0008 4.92285H22.6426V46.852H28.0008V4.92285Z" fill="#E5CDB7"/></svg>',
        school: '<svg width="30" height="32" viewBox="0 0 30 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.69811 24.3898H25.566M4.69811 24.3898C4.69811 24.7772 4.69811 25.9436 4.69811 27.6949M4.69811 24.3898V20.8305M25.566 24.3898C25.566 23.4942 25.566 22.1757 25.566 20.8305M25.566 24.3898V27.6949M25.566 20.8305C25.566 18.8663 25.566 16.845 25.566 16C25.566 14.5763 25.0377 13.5424 24.7736 13.2034C23.9934 12.3947 22.6078 10.9404 21.6038 9.83858M25.566 20.8305H27.4151C27.9434 20.8305 29 21.2373 29 22.8644C29 24.4915 29 26.0847 29 26.678C29 27.0169 28.683 27.6949 27.4151 27.6949C26.1472 27.6949 25.6541 27.6949 25.566 27.6949M25.566 27.6949V27.9492C25.566 28.9661 24.8792 31 22.1321 31C19.3849 31 10.9497 31 7.07547 31C6.28302 30.9153 4.69811 30.2373 4.69811 28.2034C4.69811 28.0289 4.69811 27.8593 4.69811 27.6949M4.69811 27.6949H2.84906C2.2327 27.6949 1 27.3898 1 26.1695C1 24.9492 1 23.1186 1 22.3559C1 21.8475 1.36981 20.8305 2.84906 20.8305C3.69434 20.8305 4.43396 20.8305 4.69811 20.8305M4.69811 20.8305V16C4.69811 15.4068 4.8566 14.0169 5.49057 13.2034C5.9523 12.6108 7.28281 11.0832 8.37987 9.83858M13.4151 7.61017C13.1376 7.61017 12.871 7.61017 12.6226 7.61017C12.2409 7.61017 11.8879 7.64474 11.566 7.70217M13.4151 7.61017V5.57627C13.4151 5.15254 13.7321 4.30508 15 4.30508C16.2679 4.30508 16.5849 5.15254 16.5849 5.57627V7.61017M13.4151 7.61017C14.4477 7.61017 15.631 7.61017 16.5849 7.61017M16.5849 7.61017C17.1194 7.61017 17.582 7.61017 17.9057 7.61017C18.0471 7.61017 18.2294 7.62088 18.434 7.64723M18.434 7.64723C19.1207 7.73567 20.0587 8.00028 20.5472 8.62712C20.749 8.88616 21.1348 9.3239 21.6038 9.83858M18.434 7.64723L21.6038 2.01695C21.8679 1.67797 22.6604 1 23.717 1C25.0377 1 26.6226 1.50847 25.8302 3.0339C25.1962 4.25424 22.7484 8.07883 21.6038 9.83858M11.566 7.70217C10.4626 7.89907 9.7255 8.36468 9.45283 8.62712C9.16579 8.94943 8.78907 9.37432 8.37987 9.83858M11.566 7.70217L8.66038 2.01695C8.48428 1.67797 7.92075 1 7.07547 1C6.23019 1 5.66667 1 5.49057 1C4.69811 1.08475 3.32453 1.61017 4.16981 3.0339C5.01509 4.45763 7.32872 8.16357 8.37987 9.83858M8.13208 15.4915V19.8136C8.13208 20.1525 8.44906 20.8305 9.71698 20.8305C10.9849 20.8305 17.6415 20.8305 20.8113 20.8305C21.2516 20.8305 22.1321 20.5763 22.1321 19.5593C22.1321 18.5424 22.1321 16.4237 22.1321 15.4915C22.1321 15.0678 21.8679 14.2203 20.8113 14.2203C19.7547 14.2203 12.9748 14.2203 9.71698 14.2203C9.18868 14.2203 8.13208 14.4746 8.13208 15.4915Z" stroke="#E5CDB7"/></svg>',
        kinder: '<svg width="30" height="29" viewBox="0 0 30 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.0994 17.0237C10.0994 17.5105 9.71039 17.8959 9.24208 17.8959C8.77387 17.8959 8.38501 17.5106 8.38501 17.0237C8.38501 16.5366 8.77392 16.1514 9.24208 16.1514C9.71034 16.1514 10.0994 16.5367 10.0994 17.0237Z" stroke="#E5CDB7"/><path d="M21.8166 17.0237C21.8166 17.5105 21.4277 17.8959 20.9594 17.8959C20.4911 17.8959 20.1023 17.5106 20.1023 17.0237C20.1023 16.5366 20.4912 16.1514 20.9594 16.1514C21.4276 16.1514 21.8166 16.5367 21.8166 17.0237Z" stroke="#E5CDB7"/><path d="M6.58187 5.95265L6.58243 5.95205C7.66711 4.79764 9.14163 4.13054 10.5711 3.75415C11.9974 3.3786 13.3398 3.30284 14.1142 3.30284H14.8544H14.9777C14.9828 3.30284 14.9976 3.30212 15.0215 3.30095C15.2888 3.28788 16.6938 3.21919 18.4181 3.48419C20.3097 3.77491 22.4701 4.45321 23.8657 5.95059L23.8676 5.95264C25.6692 7.86392 26.8443 10.613 27.5679 13.1315C28.2889 15.6408 28.5418 17.8488 28.5433 18.639C28.4528 21.7503 27.2747 24.1922 25.1977 25.8664C23.1073 27.5513 20.0537 28.5003 16.1499 28.5003H14.2992C10.3953 28.5003 7.32598 27.5512 5.22787 25.8659C3.1433 24.1915 1.96643 21.7503 1.90625 18.6414C1.90721 17.8218 2.15988 15.6118 2.8814 13.1083C3.60476 10.5985 4.77967 7.86442 6.58187 5.95265Z" stroke="#E5CDB7"/><path d="M24.5367 5.80987L24.5361 5.80929C23.1478 4.51782 22.9999 2.58306 24.0121 1.45713L24.0208 1.44748L24.0289 1.4374C24.4608 0.903775 25.282 0.56048 26.2466 0.5H26.4165C27.2741 0.5 28.0836 0.824533 28.6778 1.3118C29.2756 1.87254 29.5363 2.70706 29.4952 3.59467C29.4536 4.49016 29.1056 5.37451 28.5741 5.96576L28.5725 5.96757C28.1086 6.48858 27.5536 6.74612 26.8738 6.79953C26.1255 6.84901 25.269 6.49341 24.5367 5.80987Z" stroke="#E5CDB7"/><path d="M6.05995 1.91878L6.05981 1.91889L6.06846 1.92902C7.03258 3.05786 6.879 5.00252 5.54885 6.29448C4.8246 6.96894 3.96744 7.33296 3.08544 7.28056L3.0707 7.27968L3.05593 7.27968C2.42755 7.2795 1.87249 6.99162 1.38396 6.50079C0.860215 5.91319 0.529391 5.03696 0.501856 4.14618C0.474285 3.2542 0.750906 2.41107 1.35912 1.84681C1.94246 1.31095 2.74565 0.981445 3.67266 0.981445H3.84238C4.80675 1.04168 5.6281 1.38498 6.05995 1.91878Z" stroke="#E5CDB7"/><path d="M15.4756 20.9435C17.5707 20.9435 18.0945 19.6595 18.0945 19.0176H12.3804C12.3804 19.9805 12.8566 20.9435 15.4756 20.9435ZM15.4756 20.9435V22.1471M15.4756 22.1471C15.8724 23.0298 17.1422 24.5545 19.0469 23.5915M15.4756 22.1471C15.0787 23.0298 13.8566 24.5545 12.1423 23.5915" stroke="#E5CDB7"/></svg>',
        medicine: '<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 1V10H1V16H10V25H16V16H25V10H16V1H10Z" stroke="#E5CDB7"/></svg>',
        shop:'<svg width="26" height="29" viewBox="0 0 26 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 1L1 6.4V25.3C1 26.0161 1.28095 26.7028 1.78105 27.2092C2.28115 27.7155 2.95942 28 3.66667 28H22.3333C23.0406 28 23.7189 27.7155 24.219 27.2092C24.719 26.7028 25 26.0161 25 25.3V6.4L21 1H5Z" stroke="#E5CDB7" stroke-linecap="round" stroke-linejoin="round"/><path d="M1 6.40039H25" stroke="#E5CDB7" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.3327 11.7998C18.3327 13.232 17.7708 14.6055 16.7706 15.6182C15.7704 16.6309 14.4138 17.1998 12.9993 17.1998C11.5849 17.1998 10.2283 16.6309 9.22811 15.6182C8.22792 14.6055 7.66602 13.232 7.66602 11.7998" stroke="#E5CDB7" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        cafe :'<svg width="20" height="32" viewBox="0 0 20 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.125 20.125V20.125C18.1605 20.125 19 19.2864 19 18.2508C19 15.601 19 11.4793 19 7.75C19 4.37888 17.027 2.53683 15.1595 1.65227C14.0723 1.1373 13 2.06257 13 3.26556V20.125M17.125 20.125V29C17.125 30.1046 16.2296 31 15.125 31H15C13.8954 31 13 30.1046 13 29V20.125M17.125 20.125H13M1 1V7M1 7V11.1796C1 11.8483 1.3342 12.4728 1.8906 12.8437L2.3594 13.1563C2.9158 13.5272 3.25 14.1517 3.25 14.8204V29.125C3.25 30.1605 4.08947 31 5.125 31V31C6.16053 31 7 30.1605 7 29.125V14.8204C7 14.1517 7.3342 13.5272 7.8906 13.1563L8.3594 12.8437C8.9158 12.4728 9.25 11.8483 9.25 11.1796V7M1 7H5.125M5.125 7V1M5.125 7H9.25M9.25 7V1.75V1" stroke="#E5CDB7" stroke-linecap="round"/></svg>',
        leisure :'<svg width="32" height="26" viewBox="0 0 32 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2.07349" y="1" width="27.8571" height="8.72742" rx="2" stroke="#E5CDB7"/><rect x="1" y="13" width="30" height="5.45464" rx="2" stroke="#E5CDB7"/><path d="M3.14258 18.4541H7.42829V22.9997C7.42829 24.1042 6.53286 24.9997 5.42829 24.9997H5.14258C4.03801 24.9997 3.14258 24.1042 3.14258 22.9997V18.4541Z" stroke="#E5CDB7"/><path d="M24.5703 18.4541H28.856V22.9997C28.856 24.1042 27.9606 24.9997 26.856 24.9997H26.5703C25.4657 24.9997 24.5703 24.1042 24.5703 22.9997V18.4541Z" stroke="#E5CDB7"/><path d="M7.42578 9.72754V13.0003M24.5686 9.72754V13.0003" stroke="#E5CDB7"/></svg>',
        sport :'<svg width="32" height="19" viewBox="0 0 32 19" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="12.2393" y="7.03809" width="7.5217" height="4.92308" stroke="#E5CDB7"/><rect x="3.10864" y="1.80762" width="3.60868" height="15.3846" rx="1" stroke="#E5CDB7"/><rect x="25.2839" y="1.80762" width="3.60868" height="15.3846" rx="1" stroke="#E5CDB7"/><rect x="20.0649" y="0.5" width="4.91302" height="18" rx="1" stroke="#E5CDB7"/><rect x="7.02026" y="0.5" width="4.91302" height="18" rx="1" stroke="#E5CDB7"/><path d="M2.80434 7.53809V7.03809H2.30434H1.5C0.947715 7.03809 0.5 7.4858 0.5 8.03809V10.9612C0.5 11.5135 0.947716 11.9612 1.5 11.9612H2.30434H2.80434V11.4612V7.53809Z" stroke="#E5CDB7"/><path d="M29.6958 7.03809H29.1958V7.53809V11.4612V11.9612H29.6958H30.5001C31.0524 11.9612 31.5001 11.5135 31.5001 10.9612V8.03809C31.5001 7.4858 31.0524 7.03809 30.5001 7.03809H29.6958Z" stroke="#E5CDB7"/></svg>',
    };
    return categoriesIcons[code] ? categoriesIcons[code] : '';
}